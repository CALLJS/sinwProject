{"version":3,"sources":["../../../work/cube/Main.js"],"names":["Main","initCanvas","initCube","addEvent","canvas","document","getElementById","width","offsetWidth","height","offsetHeight","dx","dy","ctx","getContext","strokeStyle","fillStyle","cube_center","cube","render","mousedown","addEventListener","evt","initMove","move","stopMove","mx","clientX","my","clientY","theta","Math","PI","phi","rotate2","center","i","M","vertices","ct","cos","st","sin","cp","sp","x","y","z","acenter","sa","sqrt","pow","ca","sb","cb","xx","yy","zz","xx_2","yy_2","zz_2","a","b","c","a2","b2","c2","unitlen2","unitlen"],"mappings":"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","file":"Main.js","sourcesContent":["import {Vertex} from \"./js/Vertex.js\";\r\nimport {Cube} from \"./js/Cube.js\";\r\n\r\nexport class Main {\r\n    constructor() {\r\n        this.initCanvas();\r\n        this.initCube();\r\n        this.addEvent();\r\n    }\r\n\r\n    /**\r\n     * 初始化画布.\r\n     */\r\n    initCanvas() {\r\n        var canvas = document.getElementById('cnv');\r\n        canvas.width = canvas.offsetWidth;\r\n        canvas.height = canvas.offsetHeight;\r\n        this.dx = canvas.width / 2;\r\n        this.dy = canvas.height / 2;\r\n        var ctx = canvas.getContext('2d');\r\n        //画笔颜色\r\n        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';\r\n        //填充颜色\r\n        ctx.fillStyle = 'rgba(0, 150, 255, 0.3)';\r\n\r\n        this.ctx = ctx;\r\n        this.canvas = canvas;\r\n    }\r\n\r\n    /**\r\n     * 初始化立方体.\r\n     */\r\n    initCube() {\r\n        var cube_center = new Vertex(0, 11 * this.dy / 10, 0);\r\n        //var cube_center = new Vertex(0, 100, 0);\r\n        var cube = new Cube(cube_center, this.dy);\r\n        cube.render(this.ctx, this.dx, this.dy);\r\n        this.cube = cube;\r\n        this.mousedown = false;\r\n        this.cube_center = cube_center;\r\n    }\r\n\r\n    /**\r\n     * 添加鼠标事件.\r\n     */\r\n    addEvent() {\r\n        this.canvas.addEventListener('mousedown', (evt) => {\r\n            this.initMove(evt)\r\n        });\r\n        document.addEventListener('mousemove', (evt) => {\r\n            this.move(evt)\r\n        });\r\n        document.addEventListener('mouseup', () => {\r\n            this.stopMove()\r\n        });\r\n    }\r\n\r\n    initMove(evt) {\r\n        this.mousedown = true;\r\n        this.mx = evt.clientX;\r\n        this.my = evt.clientY;\r\n    }\r\n\r\n    move(evt) {\r\n        var mousedown = this.mousedown;\r\n        var mx = this.mx;\r\n        var my = this.my;\r\n\r\n        if (mousedown) {\r\n            var theta = (evt.clientX - mx) * Math.PI / 360;\r\n            var phi = (evt.clientY - my) * Math.PI / 180;\r\n            this.rotate2(theta, phi);\r\n            this.mx = evt.clientX;\r\n            this.my = evt.clientY;\r\n            this.cube.render(this.ctx, this.dx, this.dy);\r\n        }\r\n    }\r\n\r\n    stopMove() {\r\n        this.mousedown = false;\r\n    }\r\n\r\n    rotate(theta, phi) {\r\n        var center = this.cube_center;\r\n        //var center = new Vertex(0, this.dy*11/10, 0);\r\n        for (let i = 0; i < 8; i++) {\r\n            var M = this.cube.vertices[i];\r\n            // 旋转角的正余弦值\r\n            var ct = Math.cos(theta);\r\n            var st = Math.sin(theta);\r\n            var cp = Math.cos(phi);\r\n            var sp = Math.sin(phi);\r\n\r\n            // 旋转后的值\r\n            var x = M.x - center.x;\r\n            var y = M.y - center.y;\r\n            var z = M.z - center.z;\r\n            M.x = ct * x - st * cp * y + st * sp * z + center.x;\r\n            M.y = st * x + ct * cp * y - ct * sp * z + center.y;\r\n            M.z = sp * y + cp * z + center.z;\r\n        }\r\n    }\r\n\r\n    rotate1(theta, phi) {\r\n        var acenter = this.cube_center;\r\n        var center = new Vertex(0, 1, 0);\r\n        for (let i = 0; i < 8; i++) {\r\n            var M = this.cube.vertices[i];\r\n\r\n            var sa = Math.sqrt((Math.pow(center.x, 2) + Math.pow(center.y, 2)) /\r\n                (Math.pow(center.x, 2) + Math.pow(center.y, 2) + Math.pow(center.z, 2)));\r\n            var ca = Math.sqrt((Math.pow(center.z, 2)) /\r\n                (Math.pow(center.x, 2) + Math.pow(center.y, 2) + Math.pow(center.z, 2)));\r\n            var sb = Math.sqrt((Math.pow(center.y, 2)) /\r\n                (Math.pow(center.x, 2) + Math.pow(center.y, 2)));\r\n            var cb = Math.sqrt((Math.pow(center.x, 2)) /\r\n                (Math.pow(center.x, 2) + Math.pow(center.y, 2)));\r\n\r\n\r\n            var xx = sa * cb;\r\n            var yy = sa * sb;\r\n            var zz = ca;\r\n\r\n            var xx_2 = Math.pow(xx, 2);\r\n            var yy_2 = Math.pow(yy, 2);\r\n            var zz_2 = Math.pow(zz, 2);\r\n\r\n            // 旋转角的正余弦值\r\n            var ct = Math.cos(theta);\r\n            var st = Math.sin(theta);\r\n\r\n            // 旋转后的值\r\n            var x = M.x - acenter.x;\r\n            var y = M.y - acenter.y;\r\n            var z = M.z - acenter.z;\r\n\r\n            M.x = (xx * yy * (1 - ct) - zz * st) * x\r\n                + (ct + yy_2 * (1 - ct)) * y\r\n                + (zz * yy * (1 - ct) + xx * st) * z + acenter.x;\r\n            M.y = (ct + xx_2 * (1 - ct)) * x\r\n                + (yy * xx * (1 - ct) + zz * st) * y\r\n                + (zz * xx * (1 - ct) - yy * st) * z + acenter.y;\r\n            M.z = (xx * zz * (1 - ct) + yy * st) * x\r\n                + (yy * zz * (1 - ct) - xx * st) * y\r\n                + (ct + zz_2 * (1 - ct)) * z + acenter.z;\r\n        }\r\n    }\r\n\r\n    rotate2(theta, phi) {\r\n        var acenter = this.cube_center;\r\n        var center = new Vertex(0, 0, 10);\r\n\r\n        for (let i = 0; i < 8; i++) {\r\n            var M = this.cube.vertices[i];\r\n\r\n            var a = -center.x;\r\n            var b = -center.y;\r\n            var c = center.z;\r\n            var a2 = Math.pow(a, 2);\r\n            var b2 = Math.pow(b, 2);\r\n            var c2 = Math.pow(c, 2);\r\n            var unitlen2 = a2 + b2 + c2;\r\n            var unitlen = Math.sqrt(a2 + b2 + c2);\r\n            // 旋转角的正余弦值\r\n            var ct = Math.cos(theta);\r\n            var st = Math.sin(theta);\r\n\r\n            // 旋转后的值\r\n            var x = M.x - acenter.x;\r\n            var y = M.y - acenter.y;\r\n            var z = M.z - acenter.z;\r\n\r\n            M.x = (a2 + (b2 + c2) * ct) / unitlen2 * x\r\n                + (a * b * (1 - ct) - c * unitlen * st) / unitlen2 * y\r\n                + (a * c * (1 - ct) + b * unitlen * st) / unitlen2 * z + acenter.x;\r\n            M.y = (a * b * (1 - ct) + c * unitlen * st) / unitlen2 * x\r\n                + (b2 + (a2 + c2) * ct) / unitlen2 * y\r\n                + (b * c * (1 - ct) - a * unitlen * st) / unitlen2 * z + acenter.y;\r\n            M.z = (a * c * (1 - ct) - b * unitlen * st) / unitlen2 * x\r\n                + (b * c * (1 - ct) + a * unitlen * st) / unitlen2 * y\r\n                + (c2 + (a2 + b2) * ct) / unitlen2 * z + acenter.z;\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nnew Main();"]}