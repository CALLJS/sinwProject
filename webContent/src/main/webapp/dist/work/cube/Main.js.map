{"version":3,"sources":["../../../work/cube/Main.js"],"names":["Main","initCanvas","initCube","addEvent","canvas","document","getElementById","width","offsetWidth","height","offsetHeight","dx","dy","ctx","getContext","strokeStyle","fillStyle","cube_center","cube","render","mousedown","addEventListener","evt","initMove","move","stopMove","mx","clientX","my","clientY","theta","Math","PI","phi","rotate","center","i","M","vertices","ct","cos","st","sin","cp","sp","x","y","z"],"mappings":";;;;;;;;;AAAA;;AACA;;;;IAEaA,I,WAAAA,I;AACT,oBAAc;AAAA;;AACV,aAAKC,UAAL;AACA,aAAKC,QAAL;AACA,aAAKC,QAAL;AACH;;AAED;;;;;;;qCAGa;AACT,gBAAIC,SAASC,SAASC,cAAT,CAAwB,KAAxB,CAAb;AACAF,mBAAOG,KAAP,GAAeH,OAAOI,WAAtB;AACAJ,mBAAOK,MAAP,GAAgBL,OAAOM,YAAvB;AACA,iBAAKC,EAAL,GAAUP,OAAOG,KAAP,GAAe,CAAzB;AACA,iBAAKK,EAAL,GAAUR,OAAOK,MAAP,GAAgB,CAA1B;AACA,gBAAII,MAAMT,OAAOU,UAAP,CAAkB,IAAlB,CAAV;AACA;AACAD,gBAAIE,WAAJ,GAAkB,oBAAlB;AACA;AACAF,gBAAIG,SAAJ,GAAgB,wBAAhB;;AAEA,iBAAKH,GAAL,GAAWA,GAAX;AACA,iBAAKT,MAAL,GAAcA,MAAd;AACH;;AAED;;;;;;mCAGW;AACP,gBAAIa,cAAc,mBAAW,CAAX,EAAc,KAAK,KAAKL,EAAV,GAAe,EAA7B,EAAiC,CAAjC,CAAlB;AACA,gBAAIM,OAAO,eAASD,WAAT,EAAsB,KAAKL,EAA3B,CAAX;AACAM,iBAAKC,MAAL,CAAY,KAAKN,GAAjB,EAAsB,KAAKF,EAA3B,EAA+B,KAAKC,EAApC;AACA,iBAAKM,IAAL,GAAYA,IAAZ;AACA,iBAAKE,SAAL,GAAiB,KAAjB;AACA,iBAAKH,WAAL,GAAmBA,WAAnB;AACH;;AAED;;;;;;mCAGW;AAAA;;AACP,iBAAKb,MAAL,CAAYiB,gBAAZ,CAA6B,WAA7B,EAA0C,UAACC,GAAD,EAAS;AAC/C,sBAAKC,QAAL,CAAcD,GAAd;AACH,aAFD;AAGAjB,qBAASgB,gBAAT,CAA0B,WAA1B,EAAuC,UAACC,GAAD,EAAS;AAC5C,sBAAKE,IAAL,CAAUF,GAAV;AACH,aAFD;AAGAjB,qBAASgB,gBAAT,CAA0B,SAA1B,EAAqC,YAAM;AACvC,sBAAKI,QAAL;AACH,aAFD;AAGH;;;iCAEQH,G,EAAK;AACV,iBAAKF,SAAL,GAAiB,IAAjB;AACA,iBAAKM,EAAL,GAAUJ,IAAIK,OAAd;AACA,iBAAKC,EAAL,GAAUN,IAAIO,OAAd;AACH;;;6BAEIP,G,EAAK;AACN,gBAAIF,YAAY,KAAKA,SAArB;AACA,gBAAIM,KAAK,KAAKA,EAAd;AACA,gBAAIE,KAAK,KAAKA,EAAd;;AAEA,gBAAIR,SAAJ,EAAe;AACX,oBAAIU,QAAQ,CAACR,IAAIK,OAAJ,GAAcD,EAAf,IAAqBK,KAAKC,EAA1B,GAA+B,GAA3C;AACA,oBAAIC,MAAM,CAACX,IAAIO,OAAJ,GAAcD,EAAf,IAAqBG,KAAKC,EAA1B,GAA+B,GAAzC;AACA,qBAAKE,MAAL,CAAYJ,KAAZ,EAAmBG,GAAnB;AACA,qBAAKP,EAAL,GAAUJ,IAAIK,OAAd;AACA,qBAAKC,EAAL,GAAUN,IAAIO,OAAd;AACA,qBAAKX,IAAL,CAAUC,MAAV,CAAiB,KAAKN,GAAtB,EAA2B,KAAKF,EAAhC,EAAoC,KAAKC,EAAzC;AACH;AACJ;;;mCAEU;AACP,iBAAKQ,SAAL,GAAiB,KAAjB;AACH;;;+BAEMU,K,EAAOG,G,EAAK;AACf,gBAAIE,SAAS,KAAKlB,WAAlB;AACA,iBAAI,IAAImB,IAAI,CAAZ,EAAcA,IAAE,CAAhB,EAAkBA,GAAlB,EAAsB;AAClB,oBAAIC,IAAI,KAAKnB,IAAL,CAAUoB,QAAV,CAAmBF,CAAnB,CAAR;AACA;AACA,oBAAIG,KAAKR,KAAKS,GAAL,CAASV,KAAT,CAAT;AACA,oBAAIW,KAAKV,KAAKW,GAAL,CAASZ,KAAT,CAAT;AACA,oBAAIa,KAAKZ,KAAKS,GAAL,CAASP,GAAT,CAAT;AACA,oBAAIW,KAAKb,KAAKW,GAAL,CAAST,GAAT,CAAT;;AAEA;AACA,oBAAIY,IAAIR,EAAEQ,CAAF,GAAMV,OAAOU,CAArB;AACA,oBAAIC,IAAIT,EAAES,CAAF,GAAMX,OAAOW,CAArB;AACA,oBAAIC,IAAIV,EAAEU,CAAF,GAAMZ,OAAOY,CAArB;AACAV,kBAAEQ,CAAF,GAAMN,KAAKM,CAAL,GAASJ,KAAKE,EAAL,GAAUG,CAAnB,GAAuBL,KAAKG,EAAL,GAAUG,CAAjC,GAAqCZ,OAAOU,CAAlD;AACAR,kBAAES,CAAF,GAAML,KAAKI,CAAL,GAASN,KAAKI,EAAL,GAAUG,CAAnB,GAAuBP,KAAKK,EAAL,GAAUG,CAAjC,GAAqCZ,OAAOW,CAAlD;AACAT,kBAAEU,CAAF,GAAMH,KAAKE,CAAL,GAASH,KAAKI,CAAd,GAAkBZ,OAAOY,CAA/B;AACH;AACJ;;;;;;AAGL,IAAI/C,IAAJ","file":"Main.js","sourcesContent":["import {Vertex} from \"./js/Vertex.js\";\r\nimport {Cube} from \"./js/Cube.js\";\r\n\r\nexport class Main {\r\n    constructor() {\r\n        this.initCanvas();\r\n        this.initCube();\r\n        this.addEvent();\r\n    }\r\n\r\n    /**\r\n     * 初始化画布.\r\n     */\r\n    initCanvas() {\r\n        var canvas = document.getElementById('cnv');\r\n        canvas.width = canvas.offsetWidth;\r\n        canvas.height = canvas.offsetHeight;\r\n        this.dx = canvas.width / 2;\r\n        this.dy = canvas.height / 2;\r\n        var ctx = canvas.getContext('2d');\r\n        //画笔颜色\r\n        ctx.strokeStyle = 'rgba(0, 0, 0, 0.3)';\r\n        //填充颜色\r\n        ctx.fillStyle = 'rgba(0, 150, 255, 0.3)';\r\n\r\n        this.ctx = ctx;\r\n        this.canvas = canvas;\r\n    }\r\n\r\n    /**\r\n     * 初始化立方体.\r\n     */\r\n    initCube() {\r\n        var cube_center = new Vertex(0, 11 * this.dy / 10, 0);\r\n        var cube = new Cube(cube_center, this.dy);\r\n        cube.render(this.ctx, this.dx, this.dy);\r\n        this.cube = cube;\r\n        this.mousedown = false;\r\n        this.cube_center = cube_center;\r\n    }\r\n\r\n    /**\r\n     * 添加鼠标事件.\r\n     */\r\n    addEvent() {\r\n        this.canvas.addEventListener('mousedown', (evt) => {\r\n            this.initMove(evt)\r\n        });\r\n        document.addEventListener('mousemove', (evt) => {\r\n            this.move(evt)\r\n        });\r\n        document.addEventListener('mouseup', () => {\r\n            this.stopMove()\r\n        });\r\n    }\r\n\r\n    initMove(evt) {\r\n        this.mousedown = true;\r\n        this.mx = evt.clientX;\r\n        this.my = evt.clientY;\r\n    }\r\n\r\n    move(evt) {\r\n        var mousedown = this.mousedown;\r\n        var mx = this.mx;\r\n        var my = this.my;\r\n\r\n        if (mousedown) {\r\n            var theta = (evt.clientX - mx) * Math.PI / 360;\r\n            var phi = (evt.clientY - my) * Math.PI / 180;\r\n            this.rotate(theta, phi);\r\n            this.mx = evt.clientX;\r\n            this.my = evt.clientY;\r\n            this.cube.render(this.ctx, this.dx, this.dy);\r\n        }\r\n    }\r\n\r\n    stopMove() {\r\n        this.mousedown = false;\r\n    }\r\n\r\n    rotate(theta, phi) {\r\n        var center = this.cube_center;\r\n        for(let i = 0;i<8;i++){\r\n            var M = this.cube.vertices[i];\r\n            // 旋转角的正余弦值\r\n            var ct = Math.cos(theta);\r\n            var st = Math.sin(theta);\r\n            var cp = Math.cos(phi);\r\n            var sp = Math.sin(phi);\r\n\r\n            // 旋转后的值\r\n            var x = M.x - center.x;\r\n            var y = M.y - center.y;\r\n            var z = M.z - center.z;\r\n            M.x = ct * x - st * cp * y + st * sp * z + center.x;\r\n            M.y = st * x + ct * cp * y - ct * sp * z + center.y;\r\n            M.z = sp * y + cp * z + center.z;\r\n        }\r\n    }\r\n}\r\n\r\nnew Main();"]}